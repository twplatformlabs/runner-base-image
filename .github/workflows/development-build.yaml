# yamllint disable rule:line-length
# yamllint disable rule:truthy
---
name: runner-base-image development build

on:
  push:
    branches:
      - "*"
    tags:
      - "!*"

permissions:
  contents: read
  actions: read
  security-events: write

jobs:

  runner-dev-build:
    name: runner-base-image development build
    uses: twplatformlabs/gha-tools-workflows/.github/workflows/runner-dev-build.yaml@main
    with:
      working-directory: "."
      before-build: "true"
      registry: ghcr.io
      registry-username: $GHCR_LOGIN
      registry-password: $GHCR_PASSWORD
      skip-hadolint: "false"
    secrets:
      OP_SERVICE_ACCOUNT_TOKEN: ${{ secrets.OP_SERVICE_ACCOUNT_TOKEN }}

      # bake-file:
      # tag:
      # target:
      # extra-build-args:
      # hadolint-configfile:
      # hadolint-error-level:
      # hadolint-output-format:
      # hadolint-version:
      # hadolint-advanced-security:
      # op-version:
      #   description: install 1password-cli version
      #   required: false
      #   type: string
      #   default: ""

      # teller-version:
      #   description: install teller version
      #   required: false
      #   type: string
      #   default: ""

      # vault-version:
      #   description: install vault version
      #   required: false
      #   type: string
      #   default: ""

      # snyk-scan:
      #   description: perform snyk scan
      #   required: false
      #   type: string
      #   default: false

      # snyk-version:
      #   description: install snyk version
      #   required: false
      #   type: string
      #   default: ""

      # snyk-severity-threshold:
      #   description: snyk test reporting threshold
      #   required: false
      #   type: string
      #   default: low

      # snyk-token:
      #   description: snyk api-token
      #   required: false
      #   type: string
      #   default: $SNYK_TOKEN

      # snyk-organization:
      #   description: name of snyk organization
      #   required: false
      #   type: string
      #   default: ""

      # snyk-skip-base-image:
      #   description: skip performing cve scan of base image
      #   required: false
      #   type: string
      #   default: "false"

      # snyk-additional-args:
      #   description: additional custom command line flags
      #   required: false
      #   type: string
      #   default: ""

      # bats-test:
      #   description: run bats test against container
      #   required: false
      #   type: string
      #   default: false

      # bats-version:
      #   description: install bats version
      #   required: false
      #   type: string
      #   default: ""

      # bats-run-container-name:
      #   description: name for running container
      #   required: false
      #   type: string
      #   default: container-test

      # bats-entry-point:
      #   description: name of shell ( bash | ash | etc )
      #   required: false
      #   type: string
      #   default: /bin/bash

      # bats-test-path:
      #   description: name of folder with bats tests
      #   required: false
      #   type: string
      #   default: test



      # dockerfile:
      #   description: name of dockerfile
      #   required: false
      #   type: string
      #   default: "Dockerfile"

      # matrix-build:
      #   description: performs matrix build using values passed
      #   required: false
      #   type: string
      #   default: ""

      # hadolint-additional-args:
      #   description: additional custom command line flags
      #   required: false
      #   type: string
      #   default: ""

      # trivy-scan:
      #   description: perform trivy scan
      #   required: false
      #   type: string
      #   default: false

      # trivy-version:
      #   description: install trivy version
      #   required: false
      #   type: string
      #   default: ""

      # trivy-severity:
      #   description: trivy scan reporting threshold
      #   required: false
      #   type: string
      #   default: "LOW,MEDIUM,HIGH,CRITICAL"

      # trivy-additional-args:
      #   description: additional custom command line flags
      #   required: false
      #   type: string
      #   default: ""

      # grype-scan:
      #   description: perform grype scan
      #   required: false
      #   type: string
      #   default: false

      # grype-version:
      #   description: install grype version
      #   required: false
      #   type: string
      #   default: ""

      # grype-severity:
      #   description: grype scan reporting threshold
      #   required: false
      #   type: string
      #   default: "medium"

      # grype-additional-args:
      #   description: additional custom command line flags
      #   required: false
      #   type: string
      #   default: ""

      # security-scan-nofail:
      #   description: >
      #     security scan revealing issues will not cause pipeline to fail,
      #     instead the scan output will be uploaded as a pipeline artifact
      #   required: false
      #   type: string
      #   default: "false"

      # after-checkout:
      #   description: optionally call ./.github/actions/after-checkout after code checkout
      #   required: false
      #   type: string
      #   default: "false"

      # before-build:
      #   description: optionally call ./.github/actions/before-build before docker build
      #   required: false
      #   type: string
      #   default: "false"

      # after-build:
      #   description: optionally call ./.github/actions/after-build after docker build
      #   required: false
      #   type: string
      #   default: "false"

      # builder-image-version:
      #   description: default is latest
      #   type: string
      #   required: false
      #   default: "twdps/gha-container-builder:latest"